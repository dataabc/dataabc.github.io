<!doctype html> <html lang="zh-CN"> <head><link rel="manifest" href="/manifest.json"><meta name="generator" content="Hexo 3.9.0"><link rel="manifest" href="/manifest.json"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="baidu-site-verification" content="MJCpR7aaLB"> <meta name="google-site-verification" content="mW-wjW1RPYjC4XidpT7-ykLpmbz8ToSH3bIVZK2aSI8"> <meta name="msvalidate.01" content="B304126A122F8E83839808D312235A91"> <meta name="360-site-verification" content> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="keywords" content=",C#,WindowsService,C#, WindowsService, 运行exe"> <meta name="description" content="Windows服务（C#）显式运行exe程序"> <link rel="shortcut icon" href="/img/icon.png"> <title> Windows服务（C#）显式运行exe程序 | 认知自我 </title> <link rel="canonical" href="/windowsservice/"> <style>/*! minireset.css v0.0.3 | MIT License | github.com/jgthms/minireset.css */blockquote,body,dd,dl,dt,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,html,iframe,legend,li,ol,p,pre,textarea,ul{margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:400}button,input,select,textarea{margin:0}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}audio,embed,iframe,img,object,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0;text-align:left}</style> <style>.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{position:relative;min-height:1px;padding-right:15px;padding-left:15px;box-sizing:border-box}.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{float:left}.col-xs-12{width:100%}.col-xs-11{width:91.66666667%}.col-xs-10{width:83.33333333%}.col-xs-9{width:75%}.col-xs-8{width:66.66666667%}.col-xs-7{width:58.33333333%}.col-xs-6{width:50%}.col-xs-5{width:41.66666667%}.col-xs-4{width:33.33333333%}.col-xs-3{width:25%}.col-xs-2{width:16.66666667%}.col-xs-1{width:8.33333333%}.col-xs-pull-12{right:100%}.col-xs-pull-11{right:91.66666667%}.col-xs-pull-10{right:83.33333333%}.col-xs-pull-9{right:75%}.col-xs-pull-8{right:66.66666667%}.col-xs-pull-7{right:58.33333333%}.col-xs-pull-6{right:50%}.col-xs-pull-5{right:41.66666667%}.col-xs-pull-4{right:33.33333333%}.col-xs-pull-3{right:25%}.col-xs-pull-2{right:16.66666667%}.col-xs-pull-1{right:8.33333333%}.col-xs-pull-0{right:auto}.col-xs-push-12{left:100%}.col-xs-push-11{left:91.66666667%}.col-xs-push-10{left:83.33333333%}.col-xs-push-9{left:75%}.col-xs-push-8{left:66.66666667%}.col-xs-push-7{left:58.33333333%}.col-xs-push-6{left:50%}.col-xs-push-5{left:41.66666667%}.col-xs-push-4{left:33.33333333%}.col-xs-push-3{left:25%}.col-xs-push-2{left:16.66666667%}.col-xs-push-1{left:8.33333333%}.col-xs-push-0{left:auto}.col-xs-offset-12{margin-left:100%}.col-xs-offset-11{margin-left:91.66666667%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-0{margin-left:0}@media (min-width:768px){.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width:992px){.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}@media (min-width:1200px){.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9{float:left}.col-lg-12{width:100%}.col-lg-11{width:91.66666667%}.col-lg-10{width:83.33333333%}.col-lg-9{width:75%}.col-lg-8{width:66.66666667%}.col-lg-7{width:58.33333333%}.col-lg-6{width:50%}.col-lg-5{width:41.66666667%}.col-lg-4{width:33.33333333%}.col-lg-3{width:25%}.col-lg-2{width:16.66666667%}.col-lg-1{width:8.33333333%}.col-lg-pull-12{right:100%}.col-lg-pull-11{right:91.66666667%}.col-lg-pull-10{right:83.33333333%}.col-lg-pull-9{right:75%}.col-lg-pull-8{right:66.66666667%}.col-lg-pull-7{right:58.33333333%}.col-lg-pull-6{right:50%}.col-lg-pull-5{right:41.66666667%}.col-lg-pull-4{right:33.33333333%}.col-lg-pull-3{right:25%}.col-lg-pull-2{right:16.66666667%}.col-lg-pull-1{right:8.33333333%}.col-lg-pull-0{right:auto}.col-lg-push-12{left:100%}.col-lg-push-11{left:91.66666667%}.col-lg-push-10{left:83.33333333%}.col-lg-push-9{left:75%}.col-lg-push-8{left:66.66666667%}.col-lg-push-7{left:58.33333333%}.col-lg-push-6{left:50%}.col-lg-push-5{left:41.66666667%}.col-lg-push-4{left:33.33333333%}.col-lg-push-3{left:25%}.col-lg-push-2{left:16.66666667%}.col-lg-push-1{left:8.33333333%}.col-lg-push-0{left:auto}.col-lg-offset-12{margin-left:100%}.col-lg-offset-11{margin-left:91.66666667%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-0{margin-left:0}}@media (max-width:767px){.hidden-xs{display:none!important}}@media (min-width:768px) and (max-width:991px){.hidden-sm{display:none!important}}@media (min-width:992px) and (max-width:1199px){.hidden-md{display:none!important}}@media (min-width:1200px){.hidden-lg{display:none!important}}</style> <style>@font-face{font-family:octicons-link;src:url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff')}.markdown-it{text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.8;color:#333;font-family:Arial,'Hiragino Sans GB',冬青黑,'Microsoft YaHei',微软雅黑,SimSun,宋体,Helvetica,Tahoma,'Arial sans-serif';-webkit-font-smoothing:antialiased;font-size:16px;word-wrap:break-word}@media (max-width:767px){.markdown-it{font-size:14px}}.markdown-it *{box-sizing:border-box}.markdown-it::before{display:table;content:""}.markdown-it::after{display:table;clear:both;content:""}.markdown-it>:first-child{margin-top:0!important}.markdown-it>:last-child{margin-bottom:0!important}.markdown-it [type=checkbox],.markdown-it dl{padding:0}.markdown-it blockquote,.markdown-it details,.markdown-it dl,.markdown-it ol,.markdown-it p,.markdown-it pre,.markdown-it table,.markdown-it ul{margin-top:0;margin-bottom:5px}.markdown-it code,.markdown-it kbd,.markdown-it pre{font-family:monospace,monospace;font-size:1em}.markdown-it a{color:#108ee9;text-decoration:none;background-color:transparent;-webkit-text-decoration-skip:objects}.markdown-it summary{cursor:pointer;font-weight:700}.markdown-it a:active,.markdown-it a:focus,.markdown-it a:hover,.markdown-it summary:active,.markdown-it summary:focus,.markdown-it summary:hover{outline-width:0}.markdown-it details{padding:5px 10px;border:1px solid #e3e3e3;border-bottom-color:#e0e0e0;border-right-color:#ececec;background-color:#f0f8ff;box-shadow:1px 2px 1px rgba(0,0,0,.072);-webkit-box-shadow:1px 2px 1px rgba(0,0,0,.072)}.markdown-it details p{margin-bottom:0}.markdown-it a:hover{text-decoration:none;color:#108ee9}.markdown-it a:not([href]){color:inherit;text-decoration:none}.markdown-it blockquote{margin:1em 0;padding:.5em 1em;color:#666;border-left:.25em solid #108ee9;background-color:#f0f8ff;overflow:auto}.markdown-it blockquote>:first-child{margin-top:0}.markdown-it blockquote>:last-child{margin-bottom:0}.markdown-it code{padding:.2em 0;margin:0;background-color:rgba(27,31,35,.05);border-radius:3px;font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;color:#c7254e}.markdown-it code::after,.markdown-it code::before{letter-spacing:-.2em;content:"\00a0"}.markdown-it p>code{color:#c7254e}.markdown-it dd{margin-left:0}.markdown-it dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-it dl dd{padding:0 16px;margin-bottom:16px}.markdown-it h1,.markdown-it h2,.markdown-it h3,.markdown-it h4,.markdown-it h5,.markdown-it h6{margin-top:-55px;margin-bottom:5px;font-weight:600;padding-top:60px}.markdown-it h1{margin-top:0;padding-top:0;margin-bottom:20px;font-size:1.8em;font-weight:300;border-bottom:1px solid #eaecef}.markdown-it h2{font-size:1.5em}.markdown-it h3{font-size:1.25em}.markdown-it h4{font-size:1em}.markdown-it h5{font-size:.875em}.markdown-it h6{font-size:.85em;color:#6a737d}.markdown-it hr{padding:0;height:0;margin:10px 0;overflow:hidden;background:0 0;border:0;border-bottom:1px solid #dfe2e5;width:100%}.markdown-it hr::before{display:table;content:""}.markdown-it hr::after{display:table;clear:both;content:""}.markdown-it img{border-style:none;max-width:100%;box-sizing:content-box;background-color:#fff;margin-left:50%;transform:translate(-50%,0);-webkit-transform:translate(-50%,0)}.markdown-it input{line-height:inherit;font:inherit;margin:0;overflow:visible}.markdown-it kbd{line-height:10px;display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fcfcfc;border:solid 1px #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}.markdown-it pre{word-wrap:normal;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;padding:16px;overflow:auto;line-height:1.2;background-color:#f6f8fa;border-radius:3px;margin-top:10px}.markdown-it pre code{padding:0;margin:0;font-size:.85em;word-break:normal;white-space:pre;background:0 0;border:0;display:inline;overflow:visible;line-height:inherit;word-wrap:normal}.markdown-it pre code::after,.markdown-it pre code::before{content:normal}.markdown-it strong{font-weight:600}.markdown-it svg:not(:root){overflow:hidden}.markdown-it table{border-spacing:0;border-collapse:collapse;display:block;width:100%;overflow:auto}.markdown-it table thead th{background-color:#f6f8fa}.markdown-it table th{font-weight:600}.markdown-it table td,.markdown-it table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-it table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-it table tr:nth-child(2n){background-color:#f6f8fa}.markdown-it ol,.markdown-it ul{padding-left:1em}.markdown-it ol ol,.markdown-it ul ol{list-style-type:lower-roman}.markdown-it ol ol ol,.markdown-it ol ul ol,.markdown-it ul ol ol,.markdown-it ul ul ol{list-style-type:lower-alpha}.markdown-it ol ol,.markdown-it ol ul,.markdown-it ul ol,.markdown-it ul ul{margin-top:0;margin-bottom:0}.markdown-it li>p{margin-top:16px}</style> <style>.post-container .highlight,.post-container pre{overflow:auto;margin:20px 0;padding:15px;font-size:13px;color:#c5c8c6;background:#1d1f21;line-height:$line-height-code-block}.post-container pre code{padding:0;color:#c5c8c6;background:0 0;text-shadow:none}.post-container .highlight pre{border:none;margin:0;padding:1px}.post-container .highlight table{margin:0;width:auto;border:none}.post-container .highlight td{border:none!important;padding:0}.post-container .highlight figcaption{zoom:1;font-size:1em;color:#c5c8c6;line-height:1em;margin-bottom:1em}.post-container .highlight figcaption:after,.post-container .highlight figcaption:before{content:"";display:table}.post-container .highlight figcaption:after{clear:both}.post-container .highlight figcaption a{float:right;color:#c5c8c6}.post-container .highlight figcaption a:hover{border-bottom-color:#c5c8c6}.post-container .highlight .gutter pre{color:#666;text-align:right;padding-right:20px}.post-container .highlight .line{height:20px}.post-container .gist table{width:auto}.post-container .gist table td{border:none}.post-container pre .comment{color:#969896}.post-container pre .attribute,.post-container pre .css .class,.post-container pre .css .id,.post-container pre .css .pseudo,.post-container pre .html .doctype,.post-container pre .regexp,.post-container pre .ruby .constant,.post-container pre .tag,.post-container pre .variable,.post-container pre .xml .doctype,.post-container pre .xml .pi,.post-container pre .xml .tag .title{color:#c66}.post-container pre .built_in,.post-container pre .command,.post-container pre .constant,.post-container pre .literal,.post-container pre .number,.post-container pre .params,.post-container pre .preprocessor{color:#de935f}.post-container pre .css .rules .attribute,.post-container pre .formula,.post-container pre .header,.post-container pre .inheritance,.post-container pre .number,.post-container pre .ruby .class .title,.post-container pre .ruby .symbol,.post-container pre .special,.post-container pre .string,.post-container pre .value,.post-container pre .xml .cdata{color:#b5bd68}.post-container pre .css .hexcolor,.post-container pre .title{color:#8abeb7}.post-container pre .coffeescript .title,.post-container pre .function,.post-container pre .javascript .title,.post-container pre .perl .sub,.post-container pre .python .decorator,.post-container pre .python .title,.post-container pre .ruby .function .title,.post-container pre .ruby .title .keyword{color:#81a2be}.post-container pre .javascript .function,.post-container pre .keyword{color:#b294bb}</style> <style>body{font-family:"-apple-system","Open Sans",HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,sans-serif}a{text-decoration:none;color:#333}.text-center{text-align:center!important}.text-left{text-align:left!important}.text-right{text-align:right!important}.float-left{float:left!important}.float-right{float:right!important}.no-text-decoration{text-decoration:none!important}.padding-0{padding:0!important}.hide{display:none!important}body{background-color:#fff}main{display:flex;justify-content:space-between}main>div{overflow:hidden}.gkt-header-container,.main-container{margin-right:auto;margin-left:auto;padding-top:20px;padding-bottom:30px}.main-container{background:#fff}.post-list{line-height:2.8em;border-left:4px solid #f9f9f9}@media (min-width:768px){.gkt-header-container,.main-container{width:750px}.post-list{margin-left:30px}}@media (min-width:992px){.gkt-header-container,.main-container{width:990px}}@media (min-width:1200px){.gkt-header-container,.main-container{width:100%;max-width:1380px}}.post-list ul{padding-left:0!important}.post-list li{list-style-type:none;position:relative;padding-left:20px}.post-list a{text-decoration:none}.post-list li:before{position:absolute;top:50%;left:-2px;width:10px;height:10px;margin-top:-9px;margin-left:-5px;content:' ';border-radius:50%;background-color:#ddd}.post-list .post-item-parent{margin-top:20px}.post-list a{color:#000}.post-item-color-0:before{background:#1abc9c!important}.post-item-color-1:before{background:#3498db!important}.post-item-color-2:before{background:#9b59b6!important}.post-item-color-3:before{background:#e67e22!important}.post-item-color-4:before{background:#e74c3c!important}.post-list .post-text-parent{font-size:20px;font-weight:700;font-weight:700;color:#222}.post-list .post-item-title{font-size:16px;transition-duration:.5s;color:#333;vertical-align:middle;overflow:hidden}.post-list .post-item-title:hover{color:#108ee9}.post-list .post-item-date{margin-left:2px;color:hsla(0,0%,71%,.9);font-size:.85em}.post-preview{width:100%;margin-bottom:10px;box-sizing:border-box;display:flex;flex-direction:row;height:max-content}.post-preview .text-gray{color:#999!important}.post-preview .post-info{flex:1;padding-left:20px}.post-preview .post-img{width:100px;background-size:contain;background-repeat:no-repeat;background-position:center}.post-preview .post-info-center{position:relative;top:50%;left:50%;transform:translate(-50%,-50%)}.post-preview .post-info a{cursor:pointer;text-decoration:none}.post-preview .post-info .title{color:#101010;font-size:1.2em}@media (min-width:768px){.post-preview .post-img{width:120px}.post-preview .post-info{padding-right:30px}}.markdown-it .highlight table tr{background-color:transparent;border-top:none}</style> <script>window.globalAddScript=function(e,o,t){var n=document.createElement("script");n.src=e,o&&(n.onload=o),t&&(n.onerror=t),document.body.appendChild(n)},window.globalAddCss=function(e){var o=document.createElement("link");o.rel="stylesheet",o.href=e,document.body.appendChild(o)},window.getPosition=function(e){for(var o=0,t=0;e;)o+=e.offsetLeft-e.scrollLeft+e.clientLeft,t+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{x:o,y:t}};</script> <link rel="apple-touch-icon" href="/img/pwa/apple-touch-icon.png"> <meta name="apple-mobile-web-app-status-bar-style" content="#0C3C26"> <meta name="theme-color" content="#0C3C26"> </head> <body> <style>.gkt-header{background-color:#0c3c26;position:fixed;top:0;z-index:9999}.gkt-header>div{height:88px;padding:18px 16px 58px 16px}.gkt-header-title{font-size:18px;font-weight:700;color:#fff}.gkt-header-nav li{display:inline-block;padding:13px 6px;vertical-align:middle}.gkt-header-nav ul{font-weight:700;list-style:none}.gkt-header-nav a{font-size:18px;color:#fff}.gkt-cate-name.active a,.gkt-header a:hover{color:#fff}::after,::before,span{position:relative}.flex div{background-color:#0c3c26}.flex.centered div:last-child span{top:calc(((-1em / .9) + 1ex)/ 2)}.block_container>div{display:inline-block}.gkt-header-nav{float:right}.text-opacity{opacity:.4;font-weight:400}.flex centered>span,.text-opacity>span{display:block}</style> <header class="gkt-header col-xs-12 padding-0"> <div id="gkt-nav" class="gkt-header-container"> <a href="/" class="gkt-header-title float-left"> <div class="block_container"> <div class="flex centered"> <div><span> <font size="7">cognize</font> </span></div> </div> <div class="hidden-xs text-opacity"> <span>Try not to become a man of success,</span> <span>but rather try to become a man of value.</span> </div> </div> </a> <nav class="gkt-header-nav text-right"> <ul> <li class="hidden-xs"><a href="/">主页</a></li> <li><a href="/archives/">归档</a></li> <li><a href="/about/">关于</a></li> </ul> </nav> </div> </header> <div style="height:88px"></div> <div class="main-container markdown-it"> <main class="col-xs-12 padding-0"> <style>.headerlink,:target::before{content:"";display:block;height:16px}.sidebar{position:static;float:left;font-size:14px}.sidebar-left{border-right:1px solid #eaecef;margin-right:10px}.sidebar-left,.sidebar-left>div{width:280px}.sidebar-right,.sidebar-right>div{width:260px}.sidebar-wrapper li{list-style-type:square}.sidebar-wrapper a{color:rgba(0,0,0,.9);font-size:14px}.sidebar-active{color:#108ee9!important;font-weight:700}.sidebar-wrapper section{margin-bottom:10px;margin-left:10px}.sidebar-fixed{position:fixed;top:46px;margin-top:0;max-height:81%;z-index:1}</style> <style>.post-container{overflow:hidden}.post-item-date{margin-left:10px;color:hsla(0,0%,71%,.9);font-size:.85em}.series_links{border:1px solid #eaecef;padding:15px;background-color:#fff8dc;margin-bottom:20px;border-radius:5px}</style> <aside class="sidebar sidebar-left hidden-xs hidden-sm"> <div></div> <div class="sidebar-wrapper" style="top:-60px"> <section><style>.gkt-summary{border:1px solid #ddd;border-radius:3px;padding:5px;width:240px}.gkt-summary nav{overflow:hidden}.gkt-summary nav a{display:inline-block;text-align:center;color:#333;font-size:12px}.gkt-summary nav span{display:block}.gkt-summary nav .middle{border-left:1px solid #eaecef;border-right:1px solid #eaecef}.gkt-summary .number{font-weight:700}.gkt-summary .link-list{margin-top:5px;margin-bottom:-5px;padding-top:7px;border-top:1px dashed #999;display:flex}.gkt-summary .link-list a{flex:1}.gkt-summary .link-list img{width:25px;height:25px}</style> <div class="gkt-summary"> <nav> <a href="/" class="col-xs-4"> <number class="number">76</number><span>文章</span> </a> <a href="/series" class="col-xs-4 middle"> <number class="number">0</number><span>专题</span> </a> <a href="/tags" class="col-xs-4"> <number class="number">27</number><span>标签</span> </a> </nav> <div class="link-list"> <a href="https://github.com/dataabc" rel="external nofollow noopener noreferrer" target="_blank"><img src="/img/github.png"></a> <a href="https://www.v2ex.com/member/Chilly" rel="external nofollow noopener noreferrer" target="_blank"><img src="/img/v2ex.png"></a> <a href="https://twitter.com/imchenlei" rel="external nofollow noopener noreferrer" target="_blank"><img src="/img/twitter.png"></a> </div> </div></section> <section> <h3>最近的文章</h3> <ul> <li> <a href="/doctokindle/">向kindle推送doc文档</a> </li> <li> <a href="/payspotify/">支付Spotify教程</a> </li> <li> <a href="/djangopic/">Django上传并显示图片</a> </li> <li> <a href="/weibospider/">用Python编写新浪微博爬虫</a> </li> <li> <a href="/matplotlibZn/">解决matplotlib中文显示问题</a> </li> <li> <a href="/r-outer/">R语言之outer函数</a> </li> <li> <a href="/swirl/">利用swirl包学习R语言</a> </li> <li> <a href="/r-equal/">R语言中判断两个对象是否相等</a> </li> <li> <a href="/msysgiterror/">解决hexo一个奇怪的错误</a> </li> <li> <a href="/win10Gvim/">解决gvim在win10下乱码的问题</a> </li> </ul> </section> </div> </aside> <div class="col-xs-12"> <article class="post-container"> <h1> Windows服务（C#）显式运行exe程序 </h1> <p><img src="/img/loading.png" data-original="https://picture.cognize.me/public/view/2015-2-11-Windowsservice.jpg?imageslim" alt><br>&emsp;&emsp;一般来讲，用C#运行某个.exe程序，我们都会这样写：</p> <pre><code>Process.Start("xxx.exe")</code></pre> <p>&emsp;&emsp;其中，“xxx.exe”表示我们要运行的exe的路径，Process.Start()函数有多种重载，我们这里不再赘述。大多数程序都可以通过以上的代码运行exe程序，但是当我们把我们的“控制台应用程序”转成“Windows服务”后，就会出现问题。</p> <a id="more"></a> <p>&emsp;&emsp;事实上，在“Windows服务”中，上述代码还是可以运行exe程序的，但是我们看不到。在“控制台应用程序”中，我们可以看到被执行的exe程序，但是到了“Windows服务”中，该exe变成了后台执行，无法与用户进行交互。<br>原因如下：<br>&emsp;&emsp;默认情况下，服务是运行在session0下的，与普通的应用程序不在一个session，所以不能互动，但是我们可以利用函数“CreateProcessAsUser”来创建应用程序session下的进程，从而调用外部exe。<br>Windows服务（C#）显式运行外部exe程序源代码如下：</p> <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Security;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SngjIPS_WindowsService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">UserProcess</span></span><br><span class="line">    &#123;   <span class="meta">#<span class="meta-keyword">region</span> Structures</span></span><br><span class="line">        [<span class="meta">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> SECURITY_ATTRIBUTES</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">int</span> Length;</span><br><span class="line">            <span class="keyword">public</span> IntPtr lpSecurityDescriptor;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> bInheritHandle;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> STARTUPINFO</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">int</span> cb;</span><br><span class="line">            <span class="keyword">public</span> String lpReserved;</span><br><span class="line">            <span class="keyword">public</span> String lpDesktop;</span><br><span class="line">            <span class="keyword">public</span> String lpTitle;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwX;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwY;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwXSize;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwYSize;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwXCountChars;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwYCountChars;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwFillAttribute;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwFlags;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">short</span> wShowWindow;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">short</span> cbReserved2;</span><br><span class="line">            <span class="keyword">public</span> IntPtr lpReserved2;</span><br><span class="line">            <span class="keyword">public</span> IntPtr hStdInput;</span><br><span class="line">            <span class="keyword">public</span> IntPtr hStdOutput;</span><br><span class="line">            <span class="keyword">public</span> IntPtr hStdError;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">StructLayout(LayoutKind.Sequential)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> PROCESS_INFORMATION</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> IntPtr hProcess;</span><br><span class="line">            <span class="keyword">public</span> IntPtr hThread;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwProcessId;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">uint</span> dwThreadId;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Enumerations</span></span><br><span class="line">        <span class="keyword">enum</span> TOKEN_TYPE : <span class="keyword">int</span></span><br><span class="line">        &#123;</span><br><span class="line">            TokenPrimary = <span class="number">1</span>,</span><br><span class="line">            TokenImpersonation = <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> SECURITY_IMPERSONATION_LEVEL : <span class="keyword">int</span></span><br><span class="line">        &#123;</span><br><span class="line">            SecurityAnonymous = <span class="number">0</span>,</span><br><span class="line">            SecurityIdentification = <span class="number">1</span>,</span><br><span class="line">            SecurityImpersonation = <span class="number">2</span>,</span><br><span class="line">            SecurityDelegation = <span class="number">3</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">enum</span> WTSInfoClass</span><br><span class="line">        &#123;</span><br><span class="line">            InitialProgram,</span><br><span class="line">            ApplicationName,</span><br><span class="line">            WorkingDirectory,</span><br><span class="line">            OEMId,</span><br><span class="line">            SessionId,</span><br><span class="line">            UserName,</span><br><span class="line">            WinStationName,</span><br><span class="line">            DomainName,</span><br><span class="line">            ConnectState,</span><br><span class="line">            ClientBuildNumber,</span><br><span class="line">            ClientName,</span><br><span class="line">            ClientDirectory,</span><br><span class="line">            ClientProductId,</span><br><span class="line">            ClientHardwareId,</span><br><span class="line">            ClientAddress,</span><br><span class="line">            ClientDisplay,</span><br><span class="line">            ClientProtocolType</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Constants</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> TOKEN_DUPLICATE = <span class="number">0x0002</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">uint</span> MAXIMUM_ALLOWED = <span class="number">0x2000000</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> CREATE_NEW_CONSOLE = <span class="number">0x00000010</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> IDLE_PRIORITY_CLASS = <span class="number">0x40</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> NORMAL_PRIORITY_CLASS = <span class="number">0x20</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> HIGH_PRIORITY_CLASS = <span class="number">0x80</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> REALTIME_PRIORITY_CLASS = <span class="number">0x100</span>;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Win32 API Imports</span></span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"kernel32.dll"</span>, SetLastError = true)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">CloseHandle</span>(<span class="params">IntPtr hSnapshot</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"kernel32.dll"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">uint</span> <span class="title">WTSGetActiveConsoleSessionId</span>(<span class="params"></span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"wtsapi32.dll"</span>, CharSet = CharSet.Unicode, SetLastError = true), SuppressUnmanagedCodeSecurityAttribute</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">WTSQuerySessionInformation</span>(<span class="params">System.IntPtr hServer, <span class="keyword">int</span> sessionId, WTSInfoClass wtsInfoClass, <span class="keyword">out</span> System.IntPtr ppBuffer, <span class="keyword">out</span> <span class="keyword">uint</span> pBytesReturned</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"advapi32.dll"</span>, EntryPoint = <span class="meta-string">"CreateProcessAsUser"</span>, SetLastError = true, CharSet = CharSet.Ansi, CallingConvention = CallingConvention.StdCall)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">extern</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">CreateProcessAsUser</span>(<span class="params">IntPtr hToken, String lpApplicationName, String lpCommandLine, <span class="keyword">ref</span> SECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">ref</span> SECURITY_ATTRIBUTES lpThreadAttributes, <span class="keyword">bool</span> bInheritHandle, <span class="keyword">int</span> dwCreationFlags, IntPtr lpEnvironment,</span></span></span><br><span class="line"><span class="function"><span class="params">            String lpCurrentDirectory, <span class="keyword">ref</span> STARTUPINFO lpStartupInfo, <span class="keyword">out</span> PROCESS_INFORMATION lpProcessInformation</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"kernel32.dll"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">ProcessIdToSessionId</span>(<span class="params"><span class="keyword">uint</span> dwProcessId, <span class="keyword">ref</span> <span class="keyword">uint</span> pSessionId</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"advapi32.dll"</span>, EntryPoint = <span class="meta-string">"DuplicateTokenEx"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">extern</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">DuplicateTokenEx</span>(<span class="params">IntPtr ExistingTokenHandle, <span class="keyword">uint</span> dwDesiredAccess,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">ref</span> SECURITY_ATTRIBUTES lpThreadAttributes, <span class="keyword">int</span> TokenType,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> ImpersonationLevel, <span class="keyword">ref</span> IntPtr DuplicateTokenHandle</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"kernel32.dll"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">OpenProcess</span>(<span class="params"><span class="keyword">uint</span> dwDesiredAccess, <span class="keyword">bool</span> bInheritHandle, <span class="keyword">uint</span> dwProcessId</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">"advapi32"</span>, SetLastError = true), SuppressUnmanagedCodeSecurityAttribute</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">OpenProcessToken</span>(<span class="params">IntPtr ProcessHandle, <span class="keyword">int</span> DesiredAccess, <span class="keyword">ref</span> IntPtr TokenHandle</span>)</span>;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">GetCurrentActiveUser</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            IntPtr hServer = IntPtr.Zero, state = IntPtr.Zero;</span><br><span class="line">            <span class="keyword">uint</span> bCount = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// obtain the currently active session id; every logged on user in the system has a unique session id  </span></span><br><span class="line">            <span class="keyword">uint</span> dwSessionId = WTSGetActiveConsoleSessionId();</span><br><span class="line">            <span class="keyword">string</span> domain = <span class="keyword">string</span>.Empty, userName = <span class="keyword">string</span>.Empty;</span><br><span class="line">            <span class="keyword">if</span> (WTSQuerySessionInformation(hServer, (<span class="keyword">int</span>)dwSessionId, WTSInfoClass.DomainName, <span class="keyword">out</span> state, <span class="keyword">out</span> bCount))</span><br><span class="line">            &#123;</span><br><span class="line">                domain = Marshal.PtrToStringAuto(state);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (WTSQuerySessionInformation(hServer, (<span class="keyword">int</span>)dwSessionId, WTSInfoClass.UserName, <span class="keyword">out</span> state, <span class="keyword">out</span> bCount))</span><br><span class="line">            &#123;</span><br><span class="line">                userName = Marshal.PtrToStringAuto(state);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">string</span>.Format(<span class="string">"&#123;0&#125;\\&#123;1&#125;"</span>, domain, userName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>  </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Launches the given application with full admin rights, and in addition bypasses the Vista UAC prompt  </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span>  </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="applicationName"&gt;</span>The name of the application to launch<span class="doctag">&lt;/param&gt;</span>  </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="procInfo"&gt;</span>Process information regarding the launched application that gets returned to the caller<span class="doctag">&lt;/param&gt;</span>  </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span>  </span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">StartProcessAndBypassUAC</span>(<span class="params">String applicationName, String command, <span class="keyword">out</span> PROCESS_INFORMATION procInfo</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">uint</span> winlogonPid = <span class="number">0</span>;</span><br><span class="line">            IntPtr hUserTokenDup = IntPtr.Zero, hPToken = IntPtr.Zero, hProcess = IntPtr.Zero;</span><br><span class="line">            procInfo = <span class="keyword">new</span> PROCESS_INFORMATION();</span><br><span class="line">            <span class="comment">// obtain the currently active session id; every logged on user in the system has a unique session id  </span></span><br><span class="line">            <span class="keyword">uint</span> dwSessionId = WTSGetActiveConsoleSessionId();</span><br><span class="line">            <span class="comment">// obtain the process id of the winlogon process that is running within the currently active session  </span></span><br><span class="line">            Process[] processes = Process.GetProcessesByName(<span class="string">"winlogon"</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (Process p <span class="keyword">in</span> processes)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> ((<span class="keyword">uint</span>)p.SessionId == dwSessionId)</span><br><span class="line">                &#123;</span><br><span class="line">                    winlogonPid = (<span class="keyword">uint</span>)p.Id;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// obtain a handle to the winlogon process  </span></span><br><span class="line">            hProcess = OpenProcess(MAXIMUM_ALLOWED, <span class="literal">false</span>, winlogonPid);</span><br><span class="line">            <span class="comment">// obtain a handle to the access token of the winlogon process  </span></span><br><span class="line">            <span class="keyword">if</span> (!OpenProcessToken(hProcess, TOKEN_DUPLICATE, <span class="keyword">ref</span> hPToken))</span><br><span class="line">            &#123;</span><br><span class="line">                CloseHandle(hProcess);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Security attibute structure used in DuplicateTokenEx and CreateProcessAsUser  </span></span><br><span class="line">            <span class="comment">// I would prefer to not have to use a security attribute variable and to just   </span></span><br><span class="line">            <span class="comment">// simply pass null and inherit (by default) the security attributes  </span></span><br><span class="line">            <span class="comment">// of the existing token. However, in C# structures are value types and therefore  </span></span><br><span class="line">            <span class="comment">// cannot be assigned the null value.  </span></span><br><span class="line">            SECURITY_ATTRIBUTES sa = <span class="keyword">new</span> SECURITY_ATTRIBUTES();</span><br><span class="line">            sa.Length = Marshal.SizeOf(sa);</span><br><span class="line">            <span class="comment">// copy the access token of the winlogon process; the newly created token will be a primary token  </span></span><br><span class="line">            <span class="keyword">if</span> (!DuplicateTokenEx(hPToken, MAXIMUM_ALLOWED, <span class="keyword">ref</span> sa, (<span class="keyword">int</span>)SECURITY_IMPERSONATION_LEVEL.SecurityIdentification, (<span class="keyword">int</span>)TOKEN_TYPE.TokenPrimary, <span class="keyword">ref</span> hUserTokenDup))</span><br><span class="line">            &#123;</span><br><span class="line">                CloseHandle(hProcess);</span><br><span class="line">                CloseHandle(hPToken);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// By default CreateProcessAsUser creates a process on a non-interactive window station, meaning  </span></span><br><span class="line">            <span class="comment">// the window station has a desktop that is invisible and the process is incapable of receiving  </span></span><br><span class="line">            <span class="comment">// user input. To remedy this we set the lpDesktop parameter to indicate we want to enable user   </span></span><br><span class="line">            <span class="comment">// interaction with the new process.  </span></span><br><span class="line">            STARTUPINFO si = <span class="keyword">new</span> STARTUPINFO();</span><br><span class="line">            si.cb = (<span class="keyword">int</span>)Marshal.SizeOf(si);</span><br><span class="line">            si.lpDesktop = <span class="string">@"winsta0\default"</span>; <span class="comment">// interactive window station parameter; basically this indicates that the process created can display a GUI on the desktop  </span></span><br><span class="line">            <span class="comment">// flags that specify the priority and creation method of the process  </span></span><br><span class="line">            <span class="keyword">int</span> dwCreationFlags = NORMAL_PRIORITY_CLASS | CREATE_NEW_CONSOLE;</span><br><span class="line">            <span class="comment">// create a new process in the current user's logon session  </span></span><br><span class="line">            <span class="keyword">bool</span> result = CreateProcessAsUser(hUserTokenDup,        <span class="comment">// client's access token  </span></span><br><span class="line">                                            applicationName,        <span class="comment">// file to execute  </span></span><br><span class="line">                                            command,                <span class="comment">// command line  </span></span><br><span class="line">                                            <span class="keyword">ref</span> sa,                 <span class="comment">// pointer to process SECURITY_ATTRIBUTES  </span></span><br><span class="line">                                            <span class="keyword">ref</span> sa,                 <span class="comment">// pointer to thread SECURITY_ATTRIBUTES  </span></span><br><span class="line">                                            <span class="literal">false</span>,                  <span class="comment">// handles are not inheritable  </span></span><br><span class="line">                                            dwCreationFlags,        <span class="comment">// creation flags  </span></span><br><span class="line">                                            IntPtr.Zero,            <span class="comment">// pointer to new environment block   </span></span><br><span class="line">                                            <span class="literal">null</span>,                   <span class="comment">// name of current directory   </span></span><br><span class="line">                                            <span class="keyword">ref</span> si,                 <span class="comment">// pointer to STARTUPINFO structure  </span></span><br><span class="line">                                            <span class="keyword">out</span> procInfo            <span class="comment">// receives information about new process  </span></span><br><span class="line">                                            );</span><br><span class="line">            <span class="comment">// invalidate the handles  </span></span><br><span class="line">            CloseHandle(hProcess);</span><br><span class="line">            CloseHandle(hPToken);</span><br><span class="line">            CloseHandle(hUserTokenDup);</span><br><span class="line">            <span class="keyword">return</span> result; <span class="comment">// return the result  </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure> <p>调用如下：</p> <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserProcess.PROCESS_INFORMATION pInfo = <span class="keyword">new</span> UserProcess.PROCESS_INFORMATION();</span><br><span class="line">UserProcess.StartProcessAndBypassUAC(<span class="string">"xxx.exe"</span>, <span class="keyword">string</span>.Empty, <span class="keyword">out</span> pInfo);</span><br></pre></td></tr></table></figure> <p><font color="red">注意，该程序一定要写在“Windows服务”程序的代码中才有效，如果你把本程序代码写在“控制台应用程序”中运行是没有任何效果的。</font><br>参考文章：<em><a href="http://bbs.csdn.net/topics/390431360" rel="external nofollow noopener noreferrer" target="_blank">http://bbs.csdn.net/topics/390431360</a></em><br><em><a href="http://chinaforce2008.blog.163.com/blog/static/32284182013112644445536/" rel="external nofollow noopener noreferrer" target="_blank">http://chinaforce2008.blog.163.com/blog/static/32284182013112644445536/</a></em></p> <div class="hidden-xs col-xs-12 text-center"> <canvas id="geektutu-post-qr"></canvas> <p style="margin-top:-10px"><small>微信扫一扫，阅读/分享</small></p> </div> <script src="/js/qrious.min.js"></script> <script>new QRious({element:document.getElementById("geektutu-post-qr"),value:window.location.href,size:120});</script> <hr> <div> <p> <span>标签: </span> <a href="/tags/#C#"> <code style="color:#333" key="C#" class="post-label">#C#</code> </a> <a href="/tags/#WindowsService"> <code style="color:#333" key="WindowsService" class="post-label">#WindowsService</code> </a> </p> <p> <span>发表于2015-02-11 19:08:00，最后修改于2015-08-13 11:18:35。</span> </p> <p><span>本站文章欢迎链接分享，禁止全文转载。</span></p> </div> <hr> <p name="pagination"> <a class="float-left" href="/software/">« 上一篇 C#检测计算机上是否安装了某些软件</a> <a class="float-right" href="/installFirefox/">下一篇 » Centos下安装或更新Firefox浏览器</a> </p> </article> <div style="margin-top:20px"> <h3>推荐阅读</h3> <div class="post-preview"> <div class="post-img" style="background-image:url(/img/header/r.png)"></div> <div class="post-info"> <div class="post-info-center"> <div class="hidden-xs"> <span>/</span> <a class="text-gray" href="/tags/#R" title="R">R</a> <span>/</span> </div> <a href="/r-barplot/" class="title"> R语言中barplot函数的用法 </a> <p class="text-gray"> <small> <span>发表于2015-07-18，</span> <span class="hidden-xs">全文911字，</span> <span>阅读约2分钟</span> </small> </p> </div> </div> </div> <div class="post-preview"> <div class="post-img" style="background-image:url(/img/header/r.png)"></div> <div class="post-info"> <div class="post-info-center"> <div class="hidden-xs"> <span>/</span> <a class="text-gray" href="/tags/#R" title="R">R</a> <span>/</span> </div> <a href="/installpackage/" class="title"> R语言之本地安装R包 </a> <p class="text-gray"> <small> <span>发表于2014-11-20，</span> <span class="hidden-xs">全文573字，</span> <span>阅读约1分钟</span> </small> </p> </div> </div> </div> <div class="post-preview"> <div class="post-img" style="background-image:url(/img/header/emacs.png)"></div> <div class="post-info"> <div class="post-info-center"> <div class="hidden-xs"> <span>/</span> <a class="text-gray" href="/tags/#emacs" title="emacs">emacs</a> <span>/</span> </div> <a href="/emacsorg-modeRefiling/" class="title"> emacs之org-mode的转接（Refiling） </a> <p class="text-gray"> <small> <span>发表于2014-09-23，</span> <span class="hidden-xs">全文2822字，</span> <span>阅读约5分钟</span> </small> </p> </div> </div> </div> </div> <div style="margin:20px 0"> <style>#featured-tag .post-tag-item{font-size:12px;line-height:30px;display:inline-block;height:30px;margin:5px 0;padding:0 7px;color:#333;border-radius:15px;background:#f6f6f6}#featured-tag .post-tag-item:hover{color:#108ee9}</style> <div id="featured-tag"> <a class="post-tag-item" href="/tags/#C#" title="C#" rel="8">#C# (8) </a> <a class="post-tag-item" href="/tags/#转载" title="转载" rel="13">#转载 (13) </a> <a class="post-tag-item" href="/tags/#R" title="R" rel="24">#R (24) </a> <a class="post-tag-item" href="/tags/#算法" title="算法" rel="1">#算法 (1) </a> <a class="post-tag-item" href="/tags/#博客" title="博客" rel="1">#博客 (1) </a> <a class="post-tag-item" href="/tags/#Django" title="Django" rel="1">#Django (1) </a> <a class="post-tag-item" href="/tags/#dns" title="dns" rel="1">#dns (1) </a> <a class="post-tag-item" href="/tags/#kindle" title="kindle" rel="1">#kindle (1) </a> <a class="post-tag-item" href="/tags/#emacs" title="emacs" rel="13">#emacs (13) </a> <a class="post-tag-item" href="/tags/#eclipse" title="eclipse" rel="1">#eclipse (1) </a> <a class="post-tag-item" href="/tags/#域名" title="域名" rel="1">#域名 (1) </a> <a class="post-tag-item" href="/tags/#Godaddy" title="Godaddy" rel="1">#Godaddy (1) </a> <a class="post-tag-item" href="/tags/#hexo" title="hexo" rel="6">#hexo (6) </a> <a class="post-tag-item" href="/tags/#手机" title="手机" rel="1">#手机 (1) </a> <a class="post-tag-item" href="/tags/#html" title="html" rel="1">#html (1) </a> <a class="post-tag-item" href="/tags/#linux" title="linux" rel="6">#linux (6) </a> <a class="post-tag-item" href="/tags/#vim" title="vim" rel="3">#vim (3) </a> <a class="post-tag-item" href="/tags/#Python" title="Python" rel="2">#Python (2) </a> <a class="post-tag-item" href="/tags/#matplotlib" title="matplotlib" rel="1">#matplotlib (1) </a> <a class="post-tag-item" href="/tags/#vs2010" title="vs2010" rel="1">#vs2010 (1) </a> <a class="post-tag-item" href="/tags/#music" title="music" rel="1">#music (1) </a> <a class="post-tag-item" href="/tags/#数学" title="数学" rel="1">#数学 (1) </a> <a class="post-tag-item" href="/tags/#RStudio" title="RStudio" rel="1">#RStudio (1) </a> <a class="post-tag-item" href="/tags/#Amazon EC2" title="Amazon EC2" rel="1">#Amazon EC2 (1) </a> <a class="post-tag-item" href="/tags/#图床" title="图床" rel="2">#图床 (2) </a> <a class="post-tag-item" href="/tags/#WindowsService" title="WindowsService" rel="1">#WindowsService (1) </a> <a class="post-tag-item" href="/tags/#微博爬虫" title="微博爬虫" rel="1">#微博爬虫 (1) </a> </div> </div> <div style="overflow:hidden"> </div> <div id="gitalk-container"></div> <link rel="stylesheet" href="/css/gitalk.css"> <script src="/js/gitalk.min.js"></script> <script>window.addEventListener("load",function(){new Gitalk({clientID:"b2fc4981950e4e35e55d",clientSecret:"6a15521362667440fb817cd6d553a1c5b5624688",repo:"blog-comment",owner:"dataabc",admin:["dataabc"],id:window.location.pathname,distractionFreeMode:!1}).render("gitalk-container"),document.querySelector("#gitalk-container").addEventListener("click",function(e){e&&e.stopPropagation&&e.stopPropagation()})});</script> </div> <aside class="sidebar sidebar-right hidden-md hidden-xs hidden-sm"> <div></div> <div class="sidebar-wrapper"> <section> <h3>目录</h3> <div id="sidebar-toc"> </div> <script>!function(){var e=document.querySelectorAll("article h2"),t=(document.querySelectorAll("article h3"),document.querySelectorAll("#sidebar-toc a"));function o(e){for(var o=0;o<t.length;o++){var r=t[o].href.split("#");if(r&&r[r.length-1]===encodeURIComponent(e))return o}return-1}window.addEventListener("scroll",function(r){[].slice.call(t).forEach(function(e){e.classList.remove("sidebar-active")}),function(e){for(var r=document.documentElement.scrollTop||document.body.scrollTop,c=e.length-1;0<=c;c--)if(0<r-e[c].offsetTop){var n=o(e[c].id);-1!=n&&t[n].classList.add("sidebar-active");break}}(e)})}();</script></section> </div> </aside> <script>[].slice.call(document.querySelectorAll(".sidebar .sidebar-wrapper")).forEach(function(e,o){var d=0;window.addEventListener("scroll",function(r){var s=document.documentElement.scrollTop||document.body.scrollTop,c=d<s,i=getPosition(e).y-s,l=0==o?-100:40;c&&i<=(0==o?-50:40)&&e.classList.add("sidebar-fixed"),!c&&l<i&&e.classList.remove("sidebar-fixed"),d=s})});</script> </main> </div> <style>img#go-top{position:fixed;bottom:100px;width:50px;cursor:pointer}</style> <img id="go-top" src="/icon/top.png" class="hidden-xs" style="display:none"> <script>!function(){var e=document.getElementById("go-top"),t=document.querySelector(".main-container");e.addEventListener("click",function(){window.scroll(0,0)},!1),window.addEventListener("scroll",function(){var n=document.body.offsetWidth-t.getBoundingClientRect().right,o=document.documentElement.scrollTop||document.body.scrollTop;e.style.right=n+10+"px",700<o&&(e.style.display="block"),o<=700&&(e.style.display="none")})}();</script> <style>#geektutu-click-img-container{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#geektutu-click-img-container img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style> <div id="geektutu-click-img-container"> <img src alt="Big Image"> </div> <script>!function(){var t=document.querySelector("#geektutu-click-img-container"),i=t.querySelector("img"),e=document.querySelectorAll("article img");i.addEventListener("click",function(i){t.style.display="none",i&&i.stopPropagation&&i.stopPropagation()},!1);for(var n=0;n<e.length;++n){var o=e[n];o.addEventListener("click",function(e,n){return function(o){o&&o.stopPropagation&&o.stopPropagation(),window.innerWidth<980||(i.style.height=i.style.width="auto",window.innerWidth/window.innerHeight>n?i.style.height=window.innerHeight-20+"px":i.style.width=window.innerWidth-20+"px",t.style.height=window.innerHeight+"px",t.style.lineHeight=window.innerHeight+"px",t.style.display="block",i.src=e)}}(o.dataset.original,o.width/o.height),!1)}}();</script> <style>footer{width:100%;line-height:1.5;padding:20px}footer a{color:#333;text-decoration:none;margin:0 7px 7px 0;display:inline-block}.footer-hexo img{height:20px;margin-bottom:-5px}.footer-hexo a{color:#108ee9}</style> <footer class="text-center col-xs-12"> <p> <small>© 2020 - Chilly - </small> <small> <a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.beian.miit.gov.cn">鲁ICP备17040584号-1</a> </small> </p> <p> <small> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=37012402000137" style="display:inline-block;text-decoration:none;height:20px;line-height:20px" rel="external nofollow noopener noreferrer"> 鲁公网安备37012402000137号 </a> </small> </p> <p class="footer-hexo"> <small>Powered by <a target="_blank" href="https://hexo.io" rel="external nofollow noopener noreferrer">Hexo</a> | Theme <a target="_blank" href="https://github.com/geektutu/hexo-theme-geektutu" rel="external nofollow noopener noreferrer">Geektutu</a> </small> </p> </footer> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-106464683-12"),window.addEventListener("load",function(){globalAddScript("https://www.googletagmanager.com/gtag/js?id=UA-106464683-12")});</script> <script>!function(){var e=function(e){e&&e.stopPropagation&&e.stopPropagation()},t=document.querySelectorAll("a");[].slice.call(t).forEach(function(t){t.href&&-1===t.href.indexOf(window.location.host)&&(t.target="_blank"),t.addEventListener("click",e,!1)});var n=document.querySelector("article");n&&n.addEventListener("click",e,!1)}();</script> <script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1601984411143").then(function(){console.log("ServiceWorker Register Successfully.")}).catch(function(e){console.error(e)});</script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null};</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})});</script><script>!function(t){t.imageLazyLoadSetting.processImages=i;var e=t.imageLazyLoadSetting.isSPA,n=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(n=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var i,o=0;o<n.length;o++)0<=(i=(i=n[o]).getBoundingClientRect()).bottom&&0<=i.left&&i.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,i,a,r=n[o];t=r,e=function(){n=n.filter(function(t){return r!==t})},i=new Image,a=t.getAttribute("data-original"),i.onload=function(){t.src=a,e()},i.src=a}()}i(),t.addEventListener("scroll",function(){var e,n;e=i,n=t,clearTimeout(e.tId),e.tId=setTimeout(function(){e.call(n)},500)})}(this);</script></body> </html>